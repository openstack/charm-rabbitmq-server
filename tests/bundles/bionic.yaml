local_overlay_enabled: true

series: bionic

relations:
  - - cinder:amqp
    - rabbitmq-server:amqp
  - - cinder:shared-db
    - percona-cluster:shared-db
  - - cinder:identity-service
    - keystone:identity-service
  - - keystone:shared-db
    - percona-cluster:shared-db
  - - nrpe:nrpe-external-master
    - rabbitmq-server:nrpe-external-master
  - - nrpe:monitors
    - nagios:monitors

applications:
  rabbitmq-server:
    charm: ../../rabbitmq-server.charm
    num_units: 3
    constraints:
      cpu-cores=2
    options:
      min-cluster-size: 3
      max-cluster-tries: 6
      ssl: "off"
      management_plugin: "False"
      stats_cron_schedule: "*/1 * * * *"

  cinder:
    charm: ch:cinder
    num_units: 1
    channel: queens/edge

  percona-cluster:
    charm: ch:percona-cluster
    num_units: 1
    options:
      max-connections: 1000
    channel: 5.7/edge

  keystone:
    charm: ch:keystone
    num_units: 1
    options:
      admin-password: openstack
    channel: queens/edge

  nagios:
    charm: cs:nagios
    num_units: 1

  nrpe:
    charm: cs:nrpe
